import { useEffect, useState } from "react";

const API_BASE = "https://peizo-backend.onrender.com";

export default function App() {
  const [stats, setStats] = useState(null);
  const [form, setForm] = useState({
    voltage: "",
    current_uA: "",
    weight_kg: "",
    step_location: "Center",
  });
  const [prediction, setPrediction] = useState(null);

  useEffect(() => {
    fetch(`${API_BASE}/stats`)
      .then((res) => res.json())
      .then(setStats)
      .catch(console.error);
  }, []);

  async function handlePredict(e) {
    e.preventDefault();
    const res = await fetch(`${API_BASE}/predict`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        voltage: parseFloat(form.voltage),
        current_uA: parseFloat(form.current_uA),
        weight_kg: parseFloat(form.weight_kg),
        step_location: form.step_location,
      }),
    });
    const json = await res.json();
    setPrediction(json?.predicted_power_mW?.toFixed(3));
  }

  return (
    <div style={page}>
      {/* HEADER */}
      <header style={header}>
        <div>
          <div style={eyebrow}>‚ö° SMART ENERGY ¬∑ AI DASHBOARD</div>
          <h1 style={title}>Piezoelectric Smart Tile</h1>
          <p style={subtitle}>
            Predict renewable energy generation from footsteps using ML
          </p>
        </div>
        <div style={badge}>Backend: Live</div>
      </header>

      {/* HERO */}
      <section style={hero}>
        <div>
          <h2 style={heroTitle}>AI-Powered Energy Prediction</h2>
          <p style={heroText}>
            Estimates power generated by piezoelectric tiles using real-world
            parameters like weight, voltage, current and impact location.
          </p>

          <ul style={heroList}>
            <li>‚ö° Real-time prediction per step</li>
            <li>üè´ Smart campus & public infrastructure</li>
            <li>‚ôªÔ∏è Sustainable energy planning</li>
          </ul>

          <div style={avgBox}>
            <span>Average Power</span>
            <strong>
              {stats?.avg_power?.toFixed(2) ?? "--"} mW
            </strong>
          </div>
        </div>

        {/* IMAGE BACK */}
        <img
          src="/piezo-step.jpg"
          alt="Person stepping on piezoelectric tile"
          style={heroImage}
        />
      </section>

      {/* CONTENT */}
      <main style={content}>
        <div style={statsGrid}>
          <Stat label="Total Readings" value={stats?.count ?? "--"} />
          <Stat label="Avg Power (mW)" value={stats?.avg_power?.toFixed(2) ?? "--"} />
          <Stat label="Max Power (mW)" value={stats?.max_power?.toFixed(2) ?? "--"} />
          <Stat label="Min Power (mW)" value={stats?.min_power?.toFixed(2) ?? "--"} />
        </div>

        <div style={grid}>
          <Glass>
            <h3>Energy Output vs People</h3>
            <p style={muted}>
              Relationship between number of footsteps and generated energy.
            </p>
            <img
              src="/energy-output-vs-people.png"
              style={graph}
              alt="Graph"
            />
          </Glass>

          <Glass>
            <h3>Predict Power Output</h3>

            <Input label="Voltage (V)" value={form.voltage} onChange={(v) => setForm({ ...form, voltage: v })} />
            <Input label="Current (¬µA)" value={form.current_uA} onChange={(v) => setForm({ ...form, current_uA: v })} />
            <Input label="Weight (kg)" value={form.weight_kg} onChange={(v) => setForm({ ...form, weight_kg: v })} />

            <select
              value={form.step_location}
              onChange={(e) => setForm({ ...form, step_location: e.target.value })}
              style={input}
            >
              <option>Center</option>
              <option>Edge</option>
              <option>Corner</option>
            </select>

            <button style={button} onClick={handlePredict}>
              Predict
            </button>

            {prediction && (
              <div style={predictionBox}>
                üîã {prediction} mW
              </div>
            )}
          </Glass>
        </div>
      </main>
    </div>
  );
}

/* COMPONENTS */
function Glass({ children }) {
  return <div style={glass}>{children}</div>;
}

function Stat({ label, value }) {
  return (
    <div style={glass}>
      <small style={muted}>{label}</small>
      <div style={{ fontSize: 28, fontWeight: 700 }}>{value}</div>
    </div>
  );
}

function Input({ label, value, onChange }) {
  return (
    <>
      <label>{label}</label>
      <input value={value} onChange={(e) => onChange(e.target.value)} style={input} />
    </>
  );
}

/* STYLES */
const page = {
  minHeight: "100vh",
  background:
    "radial-gradient(circle at top, rgba(255,255,255,0.12), transparent 45%), #020617",
  color: "#e5e7eb",
  fontFamily: "Inter, system-ui",
};

const header = {
  display: "flex",
  justifyContent: "space-between",
  padding: "28px 48px",
  backdropFilter: "blur(30px)",
  background: "rgba(255,255,255,0.06)",
  borderBottom: "1px solid rgba(255,255,255,0.15)",
};

const eyebrow = { fontSize: 12, letterSpacing: 2, opacity: 0.8 };
const title = { margin: 0, fontSize: 30 };
const subtitle = { fontSize: 14, opacity: 0.8 };
const badge = { padding: "6px 14px", borderRadius: 999, background: "rgba(255,255,255,0.15)" };

const hero = {
  display: "grid",
  gridTemplateColumns: "1.2fr 1fr",
  gap: 40,
  padding: "60px 80px",
};

const heroTitle = { fontSize: 34 };
const heroText = { maxWidth: 520, opacity: 0.85 };
const heroList = { marginTop: 16 };

const heroImage = {
  width: "100%",
  borderRadius: 28,
  boxShadow: "0 40px 80px rgba(0,0,0,0.5)",
};

const avgBox = {
  marginTop: 20,
  padding: 16,
  borderRadius: 16,
  background: "rgba(255,255,255,0.12)",
};

const content = { padding: "40px 80px" };

const statsGrid = {
  display: "grid",
  gridTemplateColumns: "repeat(4,1fr)",
  gap: 20,
  marginBottom: 40,
};

const grid = {
  display: "grid",
  gridTemplateColumns: "1.4fr 1fr",
  gap: 24,
};

const glass = {
  background: "rgba(255,255,255,0.08)",
  backdropFilter: "blur(28px)",
  borderRadius: 24,
  padding: 24,
  border: "1px solid rgba(255,255,255,0.18)",
};

const input = {
  width: "100%",
  marginTop: 8,
  marginBottom: 12,
  padding: 10,
  borderRadius: 12,
  background: "rgba(0,0,0,0.4)",
  color: "#fff",
  border: "1px solid rgba(255,255,255,0.2)",
};

const button = {
  width: "100%",
  padding: 12,
  borderRadius: 999,
  background: "#22c55e",
  border: "none",
  fontWeight: 700,
};

const predictionBox = {
  marginTop: 16,
  padding: 16,
  borderRadius: 16,
  background: "linear-gradient(135deg,#22c55e33,#22c55e11)",
  textAlign: "center",
  fontSize: 18,
};

const graph = { width: "100%", borderRadius: 16, marginTop: 12 };
const muted = { opacity: 0.7 };
