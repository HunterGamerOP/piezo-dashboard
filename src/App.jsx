import { useEffect, useState } from "react";

const API_BASE = "https://peizo-backend.onrender.com";

export default function App() {
  const [stats, setStats] = useState(null);
  const [form, setForm] = useState({
    voltage: "",
    current_uA: "",
    weight_kg: "",
    step_location: "Center",
  });
  const [prediction, setPrediction] = useState(null);

  useEffect(() => {
    fetch(`${API_BASE}/stats`)
      .then((res) => res.json())
      .then(setStats)
      .catch(console.error);
  }, []);

  async function handlePredict(e) {
    e.preventDefault();
    const res = await fetch(`${API_BASE}/predict`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        voltage: parseFloat(form.voltage),
        current_uA: parseFloat(form.current_uA),
        weight_kg: parseFloat(form.weight_kg),
        step_location: form.step_location,
      }),
    });
    const json = await res.json();
    setPrediction(json?.predicted_power_mW?.toFixed(3));
  }

  return (
    <div style={page}>
      {/* HEADER */}
      <header style={header}>
        <div>
          <div style={eyebrow}>‚ö° SMART ENERGY ¬∑ AI DASHBOARD</div>
          <h1 style={title}>Piezoelectric Smart Tile</h1>
          <p style={subtitle}>
            Predict renewable energy generation from footsteps using ML
          </p>
        </div>
        <div style={badge}>Backend: Live</div>
      </header>

      {/* HERO */}
      <section style={hero}>
        <div>
          <h2 style={heroTitle}>AI-Powered Energy Prediction</h2>
          <p style={heroText}>
            Estimates power generated by piezoelectric tiles using real-world
            parameters like weight, voltage, current and impact location.
          </p>

          <ul style={heroList}>
            <li>‚ö° Real-time prediction per step</li>
            <li>üè´ Smart campus & public infrastructure</li>
            <li>‚ôªÔ∏è Sustainable energy planning</li>
          </ul>

          <div style={avgGlass}>
            <span style={{ opacity: 0.75 }}>Average Power</span>
            <strong style={{ fontSize: 22 }}>
              {stats?.avg_power?.toFixed(2) ?? "--"} mW
            </strong>
          </div>
        </div>

        {/* IMAGE */}
        <img
          src="/piezo-step,jpg"
          alt="Person stepping on piezoelectric tile"
          style={heroImage}
        />
      </section>

      {/* MAIN CONTENT */}
      <main style={content}>
        <div style={statsGrid}>
          <Stat label="Total Readings" value={stats?.count ?? "--"} />
          <Stat label="Avg Power (mW)" value={stats?.avg_power?.toFixed(2) ?? "--"} />
          <Stat label="Max Power (mW)" value={stats?.max_power?.toFixed(2) ?? "--"} />
          <Stat label="Min Power (mW)" value={stats?.min_power?.toFixed(2) ?? "--"} />
        </div>

        <div style={grid}>
          <Glass>
            <h3>Energy Output vs People</h3>
            <p style={muted}>
              Relationship between number of footsteps and generated energy.
            </p>
            <img
              src="/energy-output-vs-people.png"
              alt="Energy graph"
              style={graph}
            />
          </Glass>

          <Glass>
            <h3>Predict Power Output</h3>

            <Input label="Voltage (V)" value={form.voltage} onChange={(v) => setForm({ ...form, voltage: v })} />
            <Input label="Current (¬µA)" value={form.current_uA} onChange={(v) => setForm({ ...form, current_uA: v })} />
            <Input label="Weight (kg)" value={form.weight_kg} onChange={(v) => setForm({ ...form, weight_kg: v })} />

            <select
              value={form.step_location}
              onChange={(e) => setForm({ ...form, step_location: e.target.value })}
              style={input}
            >
              <option>Center</option>
              <option>Edge</option>
              <option>Corner</option>
            </select>

            <button style={button} onClick={handlePredict}>
              Predict
            </button>

            {prediction && (
              <div style={predictionBox}>
                üîã {prediction} mW
              </div>
            )}
          </Glass>
        </div>
      </main>
    </div>
  );
}

/* COMPONENTS */

function Glass({ children }) {
  return <div style={glass}>{children}</div>;
}

function Stat({ label, value }) {
  return (
    <div style={glass}>
      <small style={muted}>{label}</small>
      <div style={{ fontSize: 28, fontWeight: 700 }}>{value}</div>
    </div>
  );
}

function Input({ label, value, onChange }) {
  return (
    <>
      <label>{label}</label>
      <input value={value} onChange={(e) => onChange(e.target.value)} style={input} />
    </>
  );
}

/* STYLES ‚Äî APPLE GLASS */

const page = {
  minHeight: "100vh",
  background: `
    radial-gradient(1200px 600px at 20% -10%, rgba(255,255,255,0.18), transparent 60%),
    radial-gradient(800px 500px at 90% 20%, rgba(255,255,255,0.12), transparent 60%),
    linear-gradient(180deg, #0b1020, #020617)
  `,
  color: "#f5f7fa",
  fontFamily: "Inter, system-ui",
};

const header = {
  display: "flex",
  justifyContent: "space-between",
  padding: "28px 56px",
  backdropFilter: "blur(40px)",
  background: "rgba(255,255,255,0.06)",
  borderBottom: "1px solid rgba(255,255,255,0.18)",
};

const eyebrow = { fontSize: 12, letterSpacing: 2, opacity: 0.8 };
const title = { margin: 0, fontSize: 32, fontWeight: 700 };
const subtitle = { fontSize: 14, opacity: 0.75 };

const badge = {
  padding: "6px 16px",
  borderRadius: 999,
  background: "rgba(255,255,255,0.18)",
};

const hero = {
  display: "grid",
  gridTemplateColumns: "1.1fr 1fr",
  gap: 48,
  padding: "64px 96px",
};

const heroTitle = { fontSize: 36, fontWeight: 700 };
const heroText = { maxWidth: 540, opacity: 0.85 };
const heroList = { marginTop: 16 };

const heroImage = {
  width: "100%",
  borderRadius: 32,
  boxShadow: `
    0 60px 120px rgba(0,0,0,0.55),
    inset 0 0 0 1px rgba(255,255,255,0.25)
  `,
};

const avgGlass = {
  marginTop: 20,
  padding: 16,
  borderRadius: 16,
  background: "rgba(255,255,255,0.12)",
  backdropFilter: "blur(30px)",
};

const content = { padding: "48px 96px" };

const statsGrid = {
  display: "grid",
  gridTemplateColumns: "repeat(4,1fr)",
  gap: 24,
  marginBottom: 48,
};

const grid = {
  display: "grid",
  gridTemplateColumns: "1.4fr 1fr",
  gap: 28,
};

const glass = {
  background: "rgba(255,255,255,0.045)",
  backdropFilter: "blur(42px) saturate(180%)",
  WebkitBackdropFilter: "blur(42px) saturate(180%)",
  borderRadius: 28,
  padding: 28,
  border: "1px solid rgba(255,255,255,0.25)",
  boxShadow: `
    inset 0 1px 0 rgba(255,255,255,0.25),
    0 24px 80px rgba(0,0,0,0.35)
  `,
};

const input = {
  width: "100%",
  marginTop: 8,
  marginBottom: 14,
  padding: 12,
  borderRadius: 14,
  background: "rgba(0,0,0,0.45)",
  color: "#fff",
  border: "1px solid rgba(255,255,255,0.25)",
};

const button = {
  width: "100%",
  padding: 14,
  borderRadius: 999,
  background: "#22c55e",
  border: "none",
  fontWeight: 700,
  cursor: "pointer",
};

const predictionBox = {
  marginTop: 18,
  padding: 18,
  borderRadius: 18,
  background: "linear-gradient(135deg,#22c55e33,#22c55e11)",
  textAlign: "center",
  fontSize: 18,
  fontWeight: 700,
};

const graph = {
  width: "100%",
  borderRadius: 18,
  marginTop: 16,
};

const muted = { opacity: 0.7 };
